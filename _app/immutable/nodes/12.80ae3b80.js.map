{"version":3,"file":"12.80ae3b80.js","sources":["../../../../../../src/routes/vocabulary/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import {chords} from \"$lib/undo-redo\"\n  import Action from \"$lib/components/Action.svelte\"\n  import {onDestroy, onMount} from \"svelte\"\n  import {KEYMAP_CODES} from \"$lib/serial/keymap-codes\"\n  import {fly} from \"svelte/transition\"\n  import type {Chord} from \"$lib/serial/chord\"\n\n  const speedRating = [\n    [400, \"+100\", \"excited\", true],\n    [700, \"+50\", \"satisfied\", true],\n    [1400, \"+25\", \"neutral\", true],\n    [3000, \"0\", \"dissatisfied\", false],\n    [Infinity, \"-50\", \"sad\", false],\n  ] as const\n  const accuracyRating = [\n    [2, \"+100\", \"calm\", true],\n    [3, \"+50\", \"content\", false],\n    [5, \"+25\", \"stressed\", false],\n    [7, \"0\", \"frustrated\", false],\n    [14, \"-25\", \"very_dissatisfied\", false],\n    [Infinity, \"-50\", \"extremely_dissatisfied\", false],\n  ] as const\n\n  let next: Chord[] = []\n  let nextHandle: number\n  let took: number | undefined\n  let delta = 0\n\n  let speed: readonly [number, string, string, boolean] | undefined\n  let accuracy: readonly [number, string, string, boolean] | undefined\n  let progress = 0\n\n  let attempts = 0\n\n  let userInput = \"\"\n\n  onMount(() => {\n    runTest()\n  })\n\n  function runTest() {\n    if (took === undefined) {\n      took = performance.now()\n      delta = 0\n      attempts = 0\n      userInput = \"\"\n      if (next.length === 0) {\n        next = Array.from({length: 5}, () => $chords[Math.floor(Math.random() * $chords.length)])\n      } else {\n        next.shift()\n        next.push($chords[Math.floor(Math.random() * $chords.length)])\n        next = next\n      }\n    }\n    if (userInput === next[0].phrase.map(it => (it === 32 ? \" \" : KEYMAP_CODES[it]!.id)).join(\"\") + \" \") {\n      took = undefined\n      speed = speedRating.find(([max]) => delta <= max)\n      accuracy = accuracyRating.find(([max]) => attempts <= max)\n      progress++\n    } else {\n      delta = performance.now() - took\n    }\n\n    nextHandle = requestAnimationFrame(runTest)\n  }\n\n  let debounceTimer = 0\n\n  function backspace(event: KeyboardEvent) {\n    if (event.code === \"Backspace\") {\n      userInput = userInput.slice(0, -1)\n    }\n  }\n\n  function input(event: KeyboardEvent) {\n    const stamp = performance.now()\n    if (stamp - debounceTimer > 50) {\n      attempts++\n    }\n    debounceTimer = stamp\n    userInput += event.key\n  }\n\n  onDestroy(() => {\n    if (nextHandle) {\n      cancelAnimationFrame(nextHandle)\n    }\n  })\n</script>\n\n<svelte:window on:keydown={backspace} on:keypress={input} />\n\n<h1>Vocabulary Trainer</h1>\n\n{#if next[0]}\n  <div class=\"row\">\n    {#key progress}\n      <div in:fly={{duration: 300, x: -48}} out:fly={{duration: 1000, x: 128}} class=\"rating\">\n        {#if speed}\n          <span class=\"rating-item\">\n            <span style:color=\"var(--md-sys-color-{speed[3] ? `primary` : `error`})\" class=\"icon\">timer</span>\n            {speed[1]}\n            <span class=\"icon\">sentiment_{speed[2]}</span>\n          </span>\n        {/if}\n        {#if accuracy}\n          <span class=\"rating-item\">\n            <span style:color=\"var(--md-sys-color-{accuracy[3] ? `primary` : `error`})\" class=\"icon\"\n              >target</span\n            >\n            {accuracy[1]}\n            <span class=\"icon\">sentiment_{accuracy[2]}</span>\n          </span>\n        {/if}\n      </div>\n    {/key}\n  </div>\n  <div class=\"hint\" style:opacity={delta > 3000 ? 1 : 0}>\n    {#each next[0].actions as action}\n      <Action {action} display=\"keys\" />\n    {/each}\n  </div>\n  <div>\n    {userInput}\n  </div>\n  {#each next as chord, i}\n    <div class=\"words\" style:opacity={1 - i / next.length}>\n      {#each chord.phrase as action}\n        <Action {action} />\n      {/each}\n    </div>\n  {/each}\n{:else}\n  <p>You don't have any chords</p>\n{/if}\n\n<style lang=\"scss\">\n  .row {\n    position: relative;\n    height: 48px;\n  }\n\n  .rating-item {\n    display: flex;\n    gap: 8px;\n    justify-content: flex-start;\n  }\n\n  .rating {\n    position: absolute;\n    left: -48px;\n    width: max-content;\n  }\n</style>\n"],"names":["insert_hydration","target","p","anchor","ctx","set_style","div1","div0","div2","i","each_blocks_1","each_blocks","style_color","t2_value","t5_value","span2","append_hydration","span0","span1","dirty","set_data","t2","t5","create_if_block_2","create_if_block_1","div","div_intro","create_in_transition","fly","div_outro","create_out_transition","each_value_1","ensure_array_like","h1","speedRating","accuracyRating","next","nextHandle","took","delta","speed","accuracy","progress","attempts","userInput","onMount","runTest","$$invalidate","$chords","it","KEYMAP_CODES","max","debounceTimer","backspace","event","input","stamp","onDestroy"],"mappings":"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"}